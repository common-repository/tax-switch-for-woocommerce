(()=>{"use strict";var t={n:e=>{var i=e&&e.__esModule?()=>e.default:()=>e;return t.d(i,{a:i}),i},d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const e=window.jQuery;var i=t.n(e);const s=window.wp.data,r="wdevs_tax_switch_is_switched",a={setIsSwitched:t=>({type:"SET_IS_SWITCHED",value:t}),saveIsSwitched:t=>(localStorage.setItem(r,JSON.stringify(t)),{type:"SET_IS_SWITCHED",value:t})};let n;n=(0,s.select)("wdevs-tax-switch/store")?(0,s.select)("wdevs-tax-switch/store"):(0,s.registerStore)("wdevs-tax-switch/store",{reducer:(t=(()=>{const t=localStorage.getItem(r);return{isSwitched:!!t&&JSON.parse(t)}})(),e)=>"SET_IS_SWITCHED"===e.type?{...t,isSwitched:e.value}:t,actions:a,selectors:{getIsSwitched:t=>t.isSwitched}});const c=class{static togglePriceClasses(t,e){const i=this.displayIncludingVat(t,e);document.querySelectorAll(".wts-price-wrapper").forEach((t=>{const e=t.querySelector(":scope > .wts-price-incl"),s=t.querySelector(":scope > .wts-price-excl");i?(e.classList.remove("wts-inactive"),e.classList.add("wts-active"),s.classList.remove("wts-active"),s.classList.add("wts-inactive")):(e.classList.remove("wts-active"),e.classList.add("wts-inactive"),s.classList.remove("wts-inactive"),s.classList.add("wts-active"))}))}static displayIncludingVat(t,e){return null==e&&(e=(0,s.select)("wdevs-tax-switch/store").getIsSwitched()),"incl"===t&&!e||"excl"===t&&e}static parseBooleanValue(t){return!!t&&JSON.parse(t)}static setPriceClasses(t){return this.togglePriceClasses(t,(0,s.select)("wdevs-tax-switch/store").getIsSwitched())}static getVatTexts(t=null){const e=document.createTextNode(" ").nodeValue;let i,s;if(t){const r=jQuery(t);if(i=r.find(".wts-price-incl .wts-vat-text").first(),s=r.find(".wts-price-excl .wts-vat-text").first(),i.length||s.length)return{including:i.length?e+i.clone().prop("outerHTML"):"",excluding:s.length?e+s.clone().prop("outerHTML"):""}}return i=jQuery(".wts-price-wrapper .wts-price-incl .wts-vat-text").first(),s=jQuery(".wts-price-wrapper .wts-price-excl .wts-vat-text").first(),{including:i.length?e+i.clone().prop("outerHTML"):"",excluding:s.length?e+s.clone().prop("outerHTML"):""}}},l=class{constructor(t){this.originalTaxDisplay=t,this.priceBackups=new Map,this.vatTexts=null}init(){this.registerWooCommerceEvents(),this.initializePriceBackups()}initializePriceBackups(){i()(".tiered-pricing-dynamic-price-wrapper").each(((t,e)=>{const s=i()(e),r=s.data("product-id");this.priceBackups.has(r)||this.priceBackups.set(r,s.html())}))}registerWooCommerceEvents(){i()(".tpt__tiered-pricing").on("tiered_price_update",((t,e)=>{this.updateAllPrices(e)})),i()(".tpt__tiered-pricing").first().children().length&&(i()(document).on("reset_data",(t=>{const e=i()(t.target).closest(".variations_form");if(e.length){const t=e.data("product_id");this.resetPrices(t)}})),i()(document).on("found_variation",((t,e)=>{const i=e.variation_id;this.resetPrices(i)})))}updateAllPrices(t){if(!t.__instance)return;const e=c.displayIncludingVat(this.originalTaxDisplay);i()(".tiered-pricing-dynamic-price-wrapper").filter(((e,s)=>{const r=i()(s),a=parseInt(r.data("product-id")),n=parseInt(r.data("parent-id"));return a===n?n===t.parentId:a===t.productId})).each(((s,r)=>{const a=i()(r);if("dynamic"===a.data("price-type")){const i=this.shouldShowOriginalPrice(t),s=i?this.getOriginalPrice(t,!0):null,r=i?this.getOriginalPrice(t,!1):null,n=this.getWtsHtml(e,t.__instance.formatting.formatPrice(t.price),t.__instance.formatting.formatPrice(t.price_excl_tax),!0,s?t.__instance.formatting.formatPrice(s):null,r?t.__instance.formatting.formatPrice(r):null);a.html(n)}})),this.updateSummaryTable(t,e)}shouldShowOriginalPrice(t){return!!t.__instance.dataProvider.isProductOnSale()||t.__instance.dataProvider.showTieredPriceAsDiscount()&&t.pricing.tieredQuantity>t.__instance.dataProvider.getMinimum()}getOriginalPrice(t,e=!0){return t.__instance.dataProvider.isProductOnSale()?e?t.__instance.dataProvider.getRegularPrice():t.__instance.dataProvider.getRegularPrice()*(t.price_excl_tax/t.price):e?t.__instance.dataProvider.getOriginalPrice():t.__instance.dataProvider.getOriginalPrice()*(t.price_excl_tax/t.price)}updateSummaryTable(t,e){const i=this.getSummaryTable(t.parentId);if(!i||!i.length)return;const s=this.getWtsHtml(e,t.__instance.formatting.formatPrice(t.price),t.__instance.formatting.formatPrice(t.price_excl_tax),!0),r=this.getWtsHtml(e,t.__instance.formatting.formatPrice(t.price*t.quantity),t.__instance.formatting.formatPrice(t.price_excl_tax*t.quantity),!0);setTimeout((function(){i.find("[data-tier-pricing-table-summary-product-price]").html(s),i.find("[data-tier-pricing-table-summary-total]").html(r)}),10)}getSummaryTable(t){return t?i()(".tier-pricing-summary-table").filter(`[data-product-id=${t}]`):i()(".tier-pricing-summary-table")}resetPrices(t){const e=this.priceBackups.get(t);e&&i()(".tiered-pricing-dynamic-price-wrapper").filter(`[data-product-id=${t}]`).html(e),c.setPriceClasses(this.originalTaxDisplay)}getWtsHtml(t,e,i,s=!1,r=null,a=null){const n=this,l=(t,e)=>e?`<del>${e}</del> <ins>${t}</ins>`:t,o=`\n        <span class="wts-price-wrapper">\n            <span class="wts-price-incl ${t?"wts-active":"wts-inactive"}">\n                ${l(e,r)}\n            </span>\n            <span class="wts-price-excl ${t?"wts-inactive":"wts-active"}">\n                ${l(i,a)}\n            </span>\n        </span>\n    `;return s&&(n.vatTexts||(n.vatTexts=c.getVatTexts()),n.vatTexts)?`\n                <span class="wts-price-container">\n                    ${o}\n                    \n                <span class="wts-price-wrapper">\n                    <span class="wts-price-incl ${t?"wts-active":"wts-inactive"}">\n                        ${n.vatTexts.including}\n                    </span>\n                    <span class="wts-price-excl ${t?"wts-inactive":"wts-active"}">\n                        ${n.vatTexts.excluding}\n                    </span>\n                </span>\n            \n                </span>\n            `:`\n        <span class="wts-price-container">\n            ${o}\n        </span>\n    `}};window.addEventListener("DOMContentLoaded",(()=>{const t=window.wtsViewObject||{originalTaxDisplay:"incl"};new l(t.originalTaxDisplay).init()}))})();