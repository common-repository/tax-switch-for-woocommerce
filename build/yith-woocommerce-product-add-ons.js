(()=>{"use strict";var e={n:t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return e.d(i,{a:i}),i},d:(t,i)=>{for(var s in i)e.o(i,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:i[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.jQuery;var i=e.n(t);const s=window.wp.data,c="wdevs_tax_switch_is_switched",a={setIsSwitched:e=>({type:"SET_IS_SWITCHED",value:e}),saveIsSwitched:e=>(localStorage.setItem(c,JSON.stringify(e)),{type:"SET_IS_SWITCHED",value:e})};let n;n=(0,s.select)("wdevs-tax-switch/store")?(0,s.select)("wdevs-tax-switch/store"):(0,s.registerStore)("wdevs-tax-switch/store",{reducer:(e=(()=>{const e=localStorage.getItem(c);return{isSwitched:!!e&&JSON.parse(e)}})(),t)=>"SET_IS_SWITCHED"===t.type?{...e,isSwitched:t.value}:e,actions:a,selectors:{getIsSwitched:e=>e.isSwitched}});const r=class{static togglePriceClasses(e,t){const i=this.displayIncludingVat(e,t);document.querySelectorAll(".wts-price-wrapper").forEach((e=>{const t=e.querySelector(":scope > .wts-price-incl"),s=e.querySelector(":scope > .wts-price-excl");i?(t.classList.remove("wts-inactive"),t.classList.add("wts-active"),s.classList.remove("wts-active"),s.classList.add("wts-inactive")):(t.classList.remove("wts-active"),t.classList.add("wts-inactive"),s.classList.remove("wts-inactive"),s.classList.add("wts-active"))}))}static displayIncludingVat(e,t){return null==t&&(t=(0,s.select)("wdevs-tax-switch/store").getIsSwitched()),"incl"===e&&!t||"excl"===e&&t}static parseBooleanValue(e){return!!e&&JSON.parse(e)}static setPriceClasses(e){return this.togglePriceClasses(e,(0,s.select)("wdevs-tax-switch/store").getIsSwitched())}static getVatTexts(e=null){const t=document.createTextNode(" ").nodeValue;let i,s;if(e){const c=jQuery(e);if(i=c.find(".wts-price-incl .wts-vat-text").first(),s=c.find(".wts-price-excl .wts-vat-text").first(),i.length||s.length)return{including:i.length?t+i.clone().prop("outerHTML"):"",excluding:s.length?t+s.clone().prop("outerHTML"):""}}return i=jQuery(".wts-price-wrapper .wts-price-incl .wts-vat-text").first(),s=jQuery(".wts-price-wrapper .wts-price-excl .wts-vat-text").first(),{including:i.length?t+i.clone().prop("outerHTML"):"",excluding:s.length?t+s.clone().prop("outerHTML"):""}}},o=class{constructor(e,t){this.originalTaxDisplay=e,this.taxRate=t,this.initialPriceElement=null,window.yith_wapo&&window.yith_wapo.replace_product_price_class&&(this.initialPriceElement=i()(window.yith_wapo.replace_product_price_class).clone()),this.vatTexts=null}init(){this.registerWooCommerceEvents()}registerWooCommerceEvents(){const e=this;setTimeout((function(){const t=i()("#yith-wapo-container");if(t.length&&t.children("div").length>0&&(i()(document).on("wapo-after-calculate-product-price",((t,i)=>{e.handlePriceUpdate(),i&&i.order_price_suffix&&e.handleProductPriceReplacement(i.order_price_suffix)})),i()(document).on("found_variation",(function(t,i){i&&i.tax_rate&&(e.taxRate=i.tax_rate)})),!i()("form.variations_form").length)){const t=i()(window.yith_wapo.replace_product_price_class);if(t&&t.length){const i=t.find(".woocommerce-Price-amount bdi").html()||t.find(".woocommerce-Price-amount").html()||t.html();if(i){const t=window.wcPriceToFloat(i);if(!isNaN(t)){const i=window.floatToWcPrice(t);e.handleProductPriceReplacement(i)}}}e.handlePriceUpdate()}}),10)}handleProductPriceReplacement(e){if(window.yith_wapo&&"yes"===window.yith_wapo.replace_product_price&&window.yith_wapo.replace_product_price_class){const t=i()(window.yith_wapo.replace_product_price_class);if(t.length>0){const i=window.wcPriceToFloat(e);if(!isNaN(parseFloat(i))){const e=this.calculateAlternatePrice(i),s=window.floatToWcPrice(i),c=window.floatToWcPrice(e);this.replacePriceDisplay(t,s,c,!0)}}}}handlePriceUpdate(){const e={options:i()("#wapo-total-options-price"),order:i()("#wapo-total-order-price")};Object.entries(e).forEach((([e,t])=>{t.length&&this.updatePriceElement(t)})),r.setPriceClasses(this.originalTaxDisplay)}updatePriceElement(e){const t=e.html();if(!t)return;const i=window.wcPriceToFloat(t);if(!i)return;const s=this.calculateAlternatePrice(i),c=window.floatToWcPrice(i),a=window.floatToWcPrice(s);this.replacePriceDisplay(e,c,a)}calculateAlternatePrice(e){if(!e||e<=0||!this.taxRate)return e;const t="incl"===this.originalTaxDisplay,i=1+this.taxRate/100;let s;return s=t?e/i:e*i,Number(s.toFixed(2))}replacePriceDisplay(e,t,i,s=!1){const c=this,a=r.displayIncludingVat(this.originalTaxDisplay),n=this.getPricesBasedOnTaxDisplay(t,i),o=n.including,l=n.excluding;function p(e){return e?"wts-active":"wts-inactive"}function w(e,t){return`\n         <span class="wts-price-${t?"incl":"excl"} ${p(t===a)}">\n            ${e}\n         </span>\n      `}let d=`\n      <span class="wts-price-container">\n         <span class="wts-price-wrapper">\n            ${w(o,!0)}\n            ${w(l,!1)}\n         </span>\n   `;if(s&&(c.vatTexts||(c.vatTexts=r.getVatTexts(this.initialPriceElement)),c.vatTexts)){function u(e,t){return`\n            <span class="wts-price-${t?"incl":"excl"} ${p(t===a)}">\n               ${e}\n            </span>\n         `}d+=`\n         <span class="wts-price-wrapper">\n            ${u(c.vatTexts.including,!0)}\n            ${u(c.vatTexts.excluding,!1)}\n         </span>\n      `}d+="</span>",e.html(d.trim())}getPricesBasedOnTaxDisplay(e,t){return"incl"===this.originalTaxDisplay?{including:e,excluding:t}:{including:t,excluding:e}}};window.addEventListener("DOMContentLoaded",(()=>{const e=window.wtsViewObject||{originalTaxDisplay:"incl"},t=window.wtsCompatibilityObject||{baseTaxRate:0};new o(e.originalTaxDisplay,t.baseTaxRate).init()}))})();